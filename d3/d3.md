# D3 Notes

- Selections aren’t literally arrays of elements, rather they are arrays of arrays of elements:
- A selection is an array of groups, and each group is an array of elements. For example, d3.select returns a selection with one group containing the selected element:

  `var selection = d3.select("body");`

- While accessing a node directly is supported by D3’s API, it is more common to use `selection.node`.

- Likewise, `d3.selectAll` returns a selection with one group and any number of elements:
  example: `d3.selectAll("h2");`

- Selections returned by `d3.select` and `d3.selectAll` have exactly one group. The difference is that the group return by `d3.select` can have zero or 1 element, while the group return by `d3.selectAll` can have zero or more elements.

- The only way for you to obtain a selection with multiple groups is `selection.selectAll`. For example, for a table with n-rows and m-cells in each row, if you select all table rows and then select the rows’ cells, you’ll get a group of sibling cells for each row:

  `d3.selectAll("tr").selectAll("td");`

- With subsequent `selectAll` (not `select`), every element in the old selection becomes a group in the new selection. Only `selectAll` has this special behavior regarding grouping; `select` preserves the existing grouping.

- The `select` method must preserve the grouping structure, so it fills the missing slots with null.

- When joining elements to data by key, there are three possible logical outcomes:

  1. Update - There was a matching element for a given datum.(element eill be updated)
  2. Enter - There was no matching element for a given datum. (element will be created)
  3. Exit - There was no matching datum for a given element. (element will be deleted)

These are the three selections returned by `selection.data`, `selection.enter` and `selection.exit`, respectively.

- Using a key with the data the selection matches the data, however, the elements are not automatically reordered in the DOM. For that you must call `selection.order` or `selection.sort` .

- While `update` and `exit` are normal selections, `enter` is a subclass of selection. This is necessary because it represents elements that do not yet exist.
  An `enter` selection contains "placeholders" rather than DOM elements; these placeholders are simply objects with a **data** property.
  The implementation of `enter.select` is then specialized such that nodes are inserted into the group’s parent, replacing the placeholder.
  This is why it is critical to call `selection.selectAll` prior to a data `join`: it establishes the parent node for entering elements.

To reduce duplicate code, `enter.append` has a convenient side-effect:
it replaces null elements in the update selection with the newly-created elements from the `enter selection` .
Thus, after `enter.append`, the update selection is modified to contain both entering and updating elements.
The update selection subsequently contains all currently-displayed elements: (this does not eliminate the need for `merge()` for non-null elements!)

A common pattern to update data is given in the following updateData custom function.

```js
function updateData(data) {
  var u = d3.select("#content").selectAll("div").data(data);

  u.enter()
    .append("div")
    .merge(u)
    .text(function (d) {
      return d;
    });

  u.exit().remove();
}
```

Conceptually, the `enter` selection’s placeholders are pointers to the parent element (in this example, the document body).
The enter selection is typically only used transiently to append elements, and is often merged with the `update` selection after appending,
such that modifications can be applied to both entering and updating elements.

When `selection.each` is executed, the function that is passed to it is executed once for each element in the selection
and each time it is executed it is passed `d` (the data bound to the element), `i` (the element’s group index),
and nodes (the element’s group.) nodes[i] is used to retrieve the current element in the selection for which the function is being called.

- `selection.join(enter[, update][, exit])` is a convenience method that allows us to process the `enter`, `update`, and `exit` selections with one method call. The `join` method requires at least one argument, but may take three. The first argument may be either a string or a function and the last two must be functions. `join` returns a selection that contains a set of newly appended elements as well as the elements in the update selection.

A typical use of `join()` is simply by using a string containing the element tag to be added to `enter()` selection
(no need to specify functions for update and exit) like `join("div")`. After such call `join("div")` removes all in `exit()`, appends the specified tags to `enter()` and merge them with `update` selection. Then re-order the merged selection in DOM and return the merged selection so that subsequent operations can be done on both enter and update selection simultaneously with one code!
